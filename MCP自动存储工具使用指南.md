# MCP自动存储工具使用指南

## 概述

MCP自动存储工具专为第三方AI客户端设计，旨在让用户能够轻松、快速地将使用过的提示词存储到系统中。系统会自动进行AI分析，填充所有必要参数，最大程度减少人工干预。

## 核心特性

✅ **一键存储** - 最简化操作，自动分析填充所有参数  
✅ **智能分析** - 自动生成标题、描述、分类、标签等  
✅ **智能隐私** - 根据关键词自动判断公开/私有设置  
✅ **零门槛使用** - 无需了解复杂参数，直接粘贴内容即可  
✅ **AI增强** - 参考web服务器AI智能分析实现，质量保证

## 三个工具对比

| 工具名称 | 使用场景 | 复杂度 | 自动化程度 |
|---------|---------|--------|-----------|
| `quick_store` | 快速存储，不需要确认 | ⭐ | 🤖🤖🤖 |
| `smart_store` | 需要查看分析结果 | ⭐⭐ | 🤖🤖 |
| `analyze_and_store` | 需要精确控制 | ⭐⭐⭐ | 🤖 |

## 使用方法

### 1. 一键存储 (推荐) - `quick_store`

**最简单的使用方式，适合日常快速存储**

```typescript
// 基础用法 - 只需要内容
{
  "content": "你的提示词内容..."
}

// 自定义标题
{
  "content": "你的提示词内容...",
  "title": "我的专属提示词"
}

// 明确设为私有
{
  "content": "你的提示词内容...",
  "make_public": false
}

// 智能检测示例
{
  "content": "这是我的个人工作提示词...",
  // 系统会自动检测到"个人"关键词，设为私有
}

{
  "content": "分享给大家的通用提示词...",
  // 系统会自动检测到"分享"、"大家"关键词，设为公开
}
```

**返回结果示例：**
```json
{
  "success": true,
  "message": "✅ 提示词已成功存储！",
  "prompt": {
    "id": "12345",
    "title": "数据分析专家",
    "category": "商业",
    "tags": ["数据分析", "商业智能", "报告"],
    "version": 1.0,
    "isPublic": true
  },
  "analysis": {
    "category": "商业",
    "difficulty": "intermediate",
    "estimatedTokens": 350,
    "variables": ["数据类型", "分析目标"],
    "compatibleModels": ["llm-large", "reasoning-specialized"]
  },
  "privacy": {
    "isPublic": true,
    "source": "auto_detected",
    "detectedKeywords": {
      "private": [],
      "public": ["分享", "团队"]
    }
  }
}
```

### 2. 智能存储 - `smart_store`

**支持分析确认的完整流程**

```typescript
// 自动分析并存储
{
  "content": "你的提示词内容...",
  "auto_analyze": true,
  "confirm_before_save": false
}

// 需要确认的分析流程
{
  "content": "你的提示词内容...",
  "auto_analyze": true,
  "confirm_before_save": true
}
```

### 3. 分析并存储 - `analyze_and_store`

**分步式流程，最大控制力**

```typescript
// 第一步：仅分析
{
  "content": "你的提示词内容...",
  "analysis_only": true
}

// 第二步：基于分析结果存储
{
  "content": "你的提示词内容...",
  "analysis_result": {
    "suggestedTitle": "修改后的标题",
    "category": "学术",
    "tags": ["研究", "分析"],
    "description": "自定义描述"
  }
}
```

## 第三方客户端使用示例

### Claude/ChatGPT 客户端
```
用户: 请帮我存储这个提示词到MCP服务器
[提示词内容]

AI: 我来帮你存储这个提示词。

[调用 quick_store 工具]

存储成功！提示词已保存为"数据分析专家"，分类为"商业"，包含标签：数据分析、商业智能、报告。
```

### Cursor/VS Code 客户端
```typescript
// 用户操作：选中代码 -> 右键 -> "存储为提示词"
// 系统自动调用：
await mcp.callTool('quick_store', {
  content: selectedText,
  title: `${fileName}_${new Date().toLocaleDateString()}`
});
```

## 智能隐私检测

系统会根据提示词内容和标题中的关键词，自动判断存储为公开还是私有：

### 🔒 私有关键词检测
当内容包含以下关键词时，自动设为**私有**：
- **中文**: 个人、私有、私人、私密、内部、不公开、仅自己
- **英文**: private, personal, internal, confidential, secret

### 🌐 公开关键词检测  
当内容包含以下关键词时，明确设为**公开**：
- **中文**: 公开、分享、共享、开源、公共、团队、大家  
- **英文**: public, share, open, common, team, everyone

### 🎯 判断逻辑
1. **用户明确指定** - 通过`make_public`参数指定时，以用户设置为准
2. **检测到私有关键词** - 自动设为私有存储
3. **检测到公开关键词** - 自动设为公开存储  
4. **未检测到关键词** - 默认设为公开存储

### 📋 使用示例

**自动检测为私有**：
```typescript
{
  "content": "这是我个人的工作笔记提示词..."
  // 系统检测到"个人"，自动设为私有
}
```

**自动检测为公开**：
```typescript
{  
  "content": "分享一个通用的数据分析提示词，希望对大家有帮助..."
  // 系统检测到"分享"、"大家"，自动设为公开
}
```

**用户明确指定**：
```typescript
{
  "content": "普通的提示词内容...",
  "make_public": false  // 明确指定为私有
}
```

## 自动分析功能

系统会自动分析并填充以下信息：

### 🏷️ 分类识别
- 21个预设分类：通用、编程、文案、设计、学术、商业等
- 基于内容语义自动选择最合适的分类

### 🏃 标签提取
- 自动提取3-8个核心标签
- 功能类型：分析、创作、翻译、编程等
- 应用场景：办公、学习、研究等
- 特色功能：角色扮演、深度分析等

### 📝 智能标题生成
- 根据内容核心价值生成吸引人的标题
- 10-25字的精准概括
- 避免冗长和模糊表达

### 📋 描述自动生成
- 60-150字的核心能力描述
- 说明解决的问题和价值
- 清晰的使用场景说明

### 🎯 难度级别评估
- beginner: 新手友好
- intermediate: 中等复杂度
- advanced: 高级用户

### 🔧 变量自动识别
- 识别 `{{变量名}}` 格式的动态参数
- 自动提取可替换内容

### 🤖 兼容模型推荐
- 基于复杂度推荐适合的AI模型
- llm-large, code-specialized, reasoning-specialized等

## 最佳实践

### ✅ 推荐做法
1. **优先使用 `quick_store`** - 大多数情况下足够使用
2. **提供简洁标题** - 有助于后续查找和管理
3. **完整的提示词内容** - 包含完整的上下文信息
4. **及时存储** - 在使用过程中发现好用的提示词立即存储

### ❌ 避免做法
1. **不要存储过于简单的内容** - 如单词或短语
2. **避免重复存储** - 系统会检测相似内容
3. **不要包含敏感信息** - 默认为公开存储
4. **避免过长的单行内容** - 影响分析质量

## 错误处理

### 常见错误及解决方案

**存储失败**
- 检查内容格式是否正确
- 确认网络连接正常
- 尝试使用 `quick_store` 简化存储

**分析质量不佳**
- 提供更完整的上下文信息
- 使用 `smart_store` 手动调整
- 通过 `analyze_and_store` 精确控制

**权限问题**
- 检查API密钥配置
- 确认用户权限设置

## 高级特性

### 批量存储
```typescript
// 可以连续调用多次存储
const prompts = [prompt1, prompt2, prompt3];
for (const prompt of prompts) {
  await mcp.callTool('quick_store', { content: prompt });
}
```

### 版本管理
- 相似内容会自动创建新版本
- 支持版本历史查看和恢复

### 性能监控
- 自动记录使用统计
- 支持A/B测试对比
- 提供详细的性能报告

## 技术细节

### API接口
- **端点**: `POST /tools/{tool_name}/invoke`
- **认证**: 可选，支持匿名使用
- **格式**: JSON请求/响应
- **限制**: 内容大小限制10MB

### 数据库结构
- 提示词存储在Supabase数据库
- 支持全文搜索和语义检索
- 自动备份和版本控制

### AI分析引擎
- 基于OpenAI GPT模型
- 支持中文和英文分析
- 可配置分析深度和范围

## 总结

MCP自动存储工具让提示词管理变得极其简单：

1. **用户视角**: 粘贴内容 → 调用工具 → 自动存储完成
2. **系统视角**: AI分析 → 参数填充 → 隐私检测 → 数据库存储  
3. **管理视角**: 智能分类 → 标签体系 → 隐私控制 → 便于检索

### 🎯 核心优势

- **零门槛使用**: 只需提供内容，一键完成存储
- **智能分析**: 自动生成标题、描述、分类、标签等所有参数
- **隐私智能**: 根据关键词自动判断公开/私有，无需手动设置
- **质量保证**: 参考web服务器AI分析实现，确保分析准确性
- **灵活控制**: 支持用户明确指定，也支持完全自动化

这套工具完美契合"方便简洁易用精准"的设计目标，让第三方AI客户端的用户能够零门槛地管理和积累自己的提示词资产，同时智能保护隐私数据。 