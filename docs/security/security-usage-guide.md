# å‹å¥½å®‰å…¨å¢å¼ºä½¿ç”¨æŒ‡å— ğŸ›¡ï¸

> æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ä¿æŒç°æœ‰å¯†é’¥å’Œç”¨æˆ·ä½“éªŒçš„å‰æä¸‹ï¼Œé€æ­¥å¢å¼ºé¡¹ç›®çš„å®‰å…¨æ€§ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

**å®‰å…¨æ€§ä¸å‹å¥½æ€§å¹¶é‡**
- âœ… ä¿ç•™æ‚¨çš„ç°æœ‰ç”Ÿäº§å¯†é’¥
- âœ… ä¸å¼ºåˆ¶ç«‹å³æ›´æ”¹ä»»ä½•é…ç½®
- âœ… æä¾›å‹å¥½çš„æé†’å’Œå»ºè®®
- âœ… ç¡®ä¿å‘åå…¼å®¹æ€§
- âœ… æ”¯æŒæ¸è¿›å¼å®‰å…¨å¢å¼º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®å®‰å…¨çº§åˆ«

åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®å®‰å…¨çº§åˆ«ï¼š

```bash
# å®½æ¾æ¨¡å¼ - æœ€å¤§å…¼å®¹æ€§ï¼ŒåŸºç¡€å®‰å…¨
SECURITY_LEVEL=loose

# å¹³è¡¡æ¨¡å¼ - æ¨èè®¾ç½®ï¼Œå®‰å…¨ä¸æ˜“ç”¨æ€§çš„å¹³è¡¡
SECURITY_LEVEL=balanced

# ä¸¥æ ¼æ¨¡å¼ - æœ€é«˜å®‰å…¨æ€§
SECURITY_LEVEL=strict
```

### 2. åº”ç”¨å®‰å…¨é…ç½®

å‚è€ƒ [å®‰å…¨å®æ–½æ–¹æ¡ˆ](security-implementation.md) ä¸­çš„é…ç½®ä»£ç ï¼Œå°†å®‰å…¨ä¸­é—´ä»¶é›†æˆåˆ°æ‚¨çš„åº”ç”¨ä¸­ã€‚

## ğŸ“‹ å®‰å…¨çº§åˆ«å¯¹æ¯”

| åŠŸèƒ½ | å®½æ¾æ¨¡å¼ | å¹³è¡¡æ¨¡å¼ | ä¸¥æ ¼æ¨¡å¼ |
|------|----------|----------|----------|
| é€Ÿç‡é™åˆ¶ | ç¦ç”¨ | å¯ç”¨(å®½æ¾) | å¯ç”¨(ä¸¥æ ¼) |
| CORSç­–ç•¥ | å®½æ¾ | æ™ºèƒ½ | ä¸¥æ ¼ |
| æ–‡ä»¶ä¸Šä¼  | 100MB | 50MB | 10MB |
| å¯†é’¥è½®æ¢æé†’ | 365å¤© | 180å¤© | 90å¤© |
| æ—¥å¿—çº§åˆ« | è­¦å‘Š | ä¿¡æ¯ | è°ƒè¯• |
| å…¼å®¹æ€§ | æœ€é«˜ | é«˜ | ä¸­ç­‰ |

## ğŸ”§ åŠŸèƒ½è¯¦è§£

### å¯†é’¥ç®¡ç†ï¼ˆä¸å¼ºåˆ¶æ›´æ”¹ï¼‰

```typescript
// å¯†é’¥å¼ºåº¦æ£€æŸ¥å’Œæé†’
export const validateKeyStrength = (key: string): boolean => {
  return key.length >= 32 && /^[a-f0-9]+$/i.test(key);
};

export const scheduleKeyRotation = (keyName: string, interval: number) => {
  // å®šæœŸæé†’å¯†é’¥è½®æ¢
  setInterval(() => {
    console.warn(`âš ï¸  å»ºè®®è½®æ¢å¯†é’¥: ${keyName}`);
  }, interval);
};
```

**ç‰¹ç‚¹ï¼š**
- ğŸ” ä¸ä¼šä¿®æ”¹æ‚¨çš„ç°æœ‰å¯†é’¥
- ğŸ“Š æä¾›å¯†é’¥å¼ºåº¦è¯„ä¼°
- â° åŸºäºæ—¶é—´çš„è½®æ¢å»ºè®®
- ğŸ¯ ç”Ÿæˆæ–°å¯†é’¥çš„å»ºè®®ï¼ˆå¯é€‰ä½¿ç”¨ï¼‰

### é€Ÿç‡é™åˆ¶ï¼ˆå¯é…ç½®ï¼‰

```typescript
// è‡ªåŠ¨æ ¹æ®å®‰å…¨çº§åˆ«è°ƒæ•´é™åˆ¶
const rateLimits = {
  loose: { auth: 20, api: 500 },
  balanced: { auth: 10, api: 200 },
  strict: { auth: 5, api: 100 }
};
```

**å†…ç½‘IPè‡ªåŠ¨è±å…ï¼š**
- 127.0.0.1 (localhost)
- 192.168.x.x (å±€åŸŸç½‘)
- 10.x.x.x (å†…ç½‘)

### CORSé…ç½®ï¼ˆæ™ºèƒ½é€‚åº”ï¼‰

```typescript
// å¼€å‘ç¯å¢ƒï¼šå…è®¸æ‰€æœ‰æ¥æº
// ç”Ÿäº§ç¯å¢ƒï¼šæ™ºèƒ½CORSç­–ç•¥
const corsConfig = {
  // å®½æ¾æ¨¡å¼ï¼šè®°å½•ä½†ä¸é˜»æ­¢æœªæ³¨å†ŒåŸŸå
  // ä¸¥æ ¼æ¨¡å¼ï¼šåªå…è®¸ç™½åå•åŸŸå
  strictMode: process.env.CORS_STRICT_MODE === 'true'
};
```

### æ–‡ä»¶ä¸Šä¼ ï¼ˆçµæ´»é™åˆ¶ï¼‰

```typescript
// æ”¯æŒå¸¸è§æ–‡ä»¶ç±»å‹
const allowedTypes = [
  'image/*',     // å›¾ç‰‡æ–‡ä»¶
  'application/pdf',  // PDFæ–‡æ¡£
  'text/plain',  // æ–‡æœ¬æ–‡ä»¶
  'application/json', // JSONæ–‡ä»¶
  'video/*',     // è§†é¢‘æ–‡ä»¶
  'audio/*'      // éŸ³é¢‘æ–‡ä»¶
];
```

## ğŸ”¨ é›†æˆæ–¹å¼

### åœ¨Expressåº”ç”¨ä¸­ä½¿ç”¨

```typescript
import express from 'express';
import { securityMiddleware } from './middleware/security';

const app = express();

// åº”ç”¨å®‰å…¨ä¸­é—´ä»¶
app.use(securityMiddleware);

// å¯åŠ¨åº”ç”¨
app.listen(3000, () => {
  console.log('åº”ç”¨å·²å¯åŠ¨ï¼Œå®‰å…¨åŠŸèƒ½å·²æ¿€æ´» ğŸ›¡ï¸');
});
```

### åœ¨Next.jsä¸­ä½¿ç”¨

```typescript
// pages/api/config.ts
export default function handler(req, res) {
  const securityLevel = process.env.SECURITY_LEVEL || 'balanced';
  res.json({ securityLevel });
}
```

## ğŸ“Š ç›‘æ§å’Œæé†’

### å¯†é’¥çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥å¯†é’¥çŠ¶æ€çš„ç¤ºä¾‹è„šæœ¬
#!/bin/bash

check_key_strength() {
    local key_name=$1
    local key_value=$2
    
    if [ ${#key_value} -lt 32 ]; then
        echo "âš ï¸  $key_name: å¯†é’¥å¼ºåº¦è¾ƒå¼±ï¼ˆé•¿åº¦ < 32ï¼‰"
    else
        echo "âœ… $key_name: å¯†é’¥å¼ºåº¦è‰¯å¥½"
    fi
}

# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„å¯†é’¥
if [ -f ".env" ]; then
    source .env
    check_key_strength "JWT_SECRET" "$JWT_SECRET"
    check_key_strength "API_KEY" "$API_KEY"
fi
```

### å¯åŠ¨æ—¶çš„å‹å¥½æé†’

```
=== å¯†é’¥å®‰å…¨æé†’ ===
âš ï¸ å¯†é’¥å®‰å…¨æé†’
   æ£€æµ‹åˆ°ä¸€äº›å¯†é’¥å¼ºåº¦è¾ƒå¼±ï¼Œå»ºè®®å¢å¼ºä»¥æé«˜å®‰å…¨æ€§
   å»ºè®®è¡ŒåŠ¨ï¼šå¯åœ¨ç³»ç»Ÿç©ºé—²æ—¶æ›´æ–°è¿™äº›å¯†é’¥ï¼Œä¸ä¼šå½±å“å½“å‰æœåŠ¡

â„¹ï¸ å¯†é’¥è½®æ¢å»ºè®®
   ä»¥ä¸‹å¯†é’¥å»ºè®®å®šæœŸè½®æ¢ï¼šJWT_SECRET
   å»ºè®®è¡ŒåŠ¨ï¼šå»ºè®®åœ¨ç»´æŠ¤çª—å£æœŸé—´æ›´æ–°è¿™äº›å¯†é’¥
===================
```

## ğŸ”„ æ¸è¿›å¼å‡çº§è·¯å¾„

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®‰å…¨ï¼ˆå³æ—¶ç”Ÿæ•ˆï¼‰
- âœ… å¯ç”¨åŸºç¡€å®‰å…¨å¤´
- âœ… æ·»åŠ è¾“å…¥éªŒè¯
- âœ… é…ç½®å‹å¥½çš„é”™è¯¯å¤„ç†

### ç¬¬äºŒé˜¶æ®µï¼šä¸­çº§å®‰å…¨ï¼ˆ1-2å‘¨å†…ï¼‰
- âœ… é…ç½®é€Ÿç‡é™åˆ¶
- âœ… å¢å¼ºCORSç­–ç•¥
- âœ… å®æ–½æ–‡ä»¶ä¸Šä¼ é™åˆ¶

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§å®‰å…¨ï¼ˆæŒ‰éœ€å®æ–½ï¼‰
- âœ… å¯†é’¥è½®æ¢ç­–ç•¥
- âœ… é«˜çº§ç›‘æ§å’Œæ—¥å¿—
- âœ… å®‰å…¨å®¡è®¡é›†æˆ

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: é€Ÿç‡é™åˆ¶å¤ªä¸¥æ ¼ï¼Œå½±å“æ­£å¸¸ä½¿ç”¨æ€ä¹ˆåŠï¼Ÿ**
A: åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```bash
SECURITY_LEVEL=loose
# æˆ–è€…
RATE_LIMIT_ENABLED=false
```

**Q: CORSé˜»æ­¢äº†åˆæ³•çš„è¯·æ±‚ï¼Ÿ**
A: è®¾ç½®å…è®¸çš„æºåŸŸåï¼š
```bash
ALLOWED_ORIGINS=https://yourdomain.com,https://api.yourdomain.com
```

**Q: å¦‚ä½•å®Œå…¨ç¦ç”¨æŸä¸ªå®‰å…¨åŠŸèƒ½ï¼Ÿ**
A: æ¯ä¸ªåŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡å•ç‹¬æ§åˆ¶ï¼š
```bash
RATE_LIMIT_ENABLED=false
CORS_STRICT_MODE=false
KEY_CHECK_ON_STARTUP=false
```

### æ¢å¤é»˜è®¤è®¾ç½®

å¦‚æœéœ€è¦æ¢å¤åˆ°é»˜è®¤é…ç½®ï¼š

```bash
# åˆ é™¤æˆ–é‡å‘½åå½“å‰é…ç½®
mv .env .env.backup

# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# é‡å¯åº”ç”¨
npm restart
```

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

1. **ä»å¹³è¡¡æ¨¡å¼å¼€å§‹**ï¼šæ¨èä½¿ç”¨ `SECURITY_LEVEL=balanced`
2. **ç›‘æ§åº”ç”¨è¡Œä¸º**ï¼šè§‚å¯Ÿå®‰å…¨åŠŸèƒ½å¯¹åº”ç”¨çš„å½±å“
3. **æ¸è¿›å¼è°ƒæ•´**ï¼šæ ¹æ®éœ€è¦é€æ­¥å¢å¼ºæˆ–æ”¾å®½å®‰å…¨ç­–ç•¥
4. **å®šæœŸæ£€æŸ¥**ï¼šå»ºç«‹å®šæœŸçš„å®‰å…¨æ£€æŸ¥æµç¨‹
5. **æ–‡æ¡£æ›´æ–°**ï¼šä¿æŒå®‰å…¨é…ç½®æ–‡æ¡£çš„æ›´æ–°

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å®‰å…¨é…ç½®æŒ‡å—](security-guide.md)
- [å®‰å…¨å®æ–½æ–¹æ¡ˆ](security-implementation.md)
- [å®‰å…¨å®¡è®¡æŠ¥å‘Š](security-audit-fixes.md)

---

**æé†’**ï¼šå®‰å…¨é…ç½®åº”è¯¥æ ¹æ®æ‚¨çš„å…·ä½“ä½¿ç”¨åœºæ™¯å’Œé£é™©è¯„ä¼°æ¥è°ƒæ•´ã€‚å¦‚æœ‰ç–‘é—®ï¼Œå»ºè®®å’¨è¯¢å®‰å…¨ä¸“å®¶ã€‚ 