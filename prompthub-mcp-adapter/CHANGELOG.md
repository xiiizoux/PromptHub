# 更新日志

## [2.1.1] - 2024-12-24

### 🐛 Bug 修复
- 修复搜索结果内容显示格式化问题，统一显示"**提示词内容：**"
- 优化内容提取逻辑，降低最小内容长度阈值从20字符到10字符
- 改进messages字段内容提取的兼容性

### 🔧 改进
- 提高内容提取的成功率，减少"暂无内容预览"的情况
- 优化搜索结果显示的一致性

## [2.1.0] - 2024-12-24

### 🗑️ 重大更新：移除性能分析功能
- **移除性能分析工具**：完全删除了所有性能分析相关的工具和功能
  - 删除 `track_prompt_usage` - 记录提示词使用数据
  - 删除 `submit_prompt_feedback` - 提交提示词反馈
  - 删除 `get_prompt_performance` - 获取提示词性能数据
  - 删除 `generate_performance_report` - 生成性能报告
  - 删除 `create_ab_test` - 创建A/B测试
  - 删除 `get_ab_test_results` - 获取A/B测试结果

### ✅ 保留核心功能
- **核心搜索工具**：`unified_search` - 统一搜索引擎保持完整功能
- **提示词管理**：所有基础的CRUD操作保持不变
- **智能功能**：`unified_store`、`prompt_optimizer` 等核心功能完全保留

### 🎯 改进效果
- **代码简化**：移除了大量性能分析相关代码，提高维护性
- **功能聚焦**：专注于核心的提示词管理和搜索功能
- **性能提升**：适配器启动更快，工具数量减少
- **架构清晰**：与主项目保持一致，不再提供性能分析功能

### 📦 升级说明
- **无破坏性更改**：核心功能保持完全兼容
- **自动更新**：使用 `npx prompthub-mcp-adapter` 自动获取最新版本
- **配置不变**：MCP客户端配置无需修改

## [1.8.1] - 2025-01-19

### 🛠️ 数据库修复
- **外键约束修复**：解决了`prompts_user_id_fkey`外键约束错误，修复存储功能失败问题
- **用户验证增强**：添加了详细的用户存在性验证，提供更好的错误诊断
- **系统用户逻辑清理**：移除了过时的系统用户回退逻辑，简化权限管理
- **存储权限优化**：修复了权限检查中的特殊用户处理问题

### 🔧 技术改进
- 增强了createPrompt方法中的用户验证流程
- 改进了错误日志记录，提供更详细的调试信息
- 优化了数据库插入前的数据验证机制
- 修复了数据库Schema与代码逻辑的不一致问题

### 🐛 问题修复
- 修复了存储功能中的外键约束违反错误
- 解决了API密钥验证成功但存储失败的问题
- 修复了用户ID与数据库约束不匹配的问题

### 📦 部署说明
- 需要执行数据库修复脚本：`scripts/fix_foreign_key_constraints.sql`
- 修复后存储功能应立即恢复正常
- 搜索功能保持稳定，不受此次修复影响

## [1.7.0] - 2024-01-27

### 🎯 重要修复
- **数据库字段一致性修复**：移除了对不存在的`content`字段的错误引用，确保代码与数据库schema完全一致
- **字段使用优化**：正确使用`description`字段作为内容备选，确保搜索结果显示准确

### 🔧 技术改进
- 修复了搜索结果格式化中的字段引用错误
- 优化了内容提取逻辑，提高搜索准确度
- 增强了错误处理和字段验证机制
- 消除了TypeScript类型不匹配问题

### 🛡️ 兼容性
- 向后兼容，无破坏性更改
- 不需要数据迁移
- 提高了系统稳定性和准确性

### 📦 包管理
- 创建了v1.7.0打包文件
- 添加了详细的测试脚本
- 完善了发布说明文档

## [1.6.0] - 2024-01-26

### 新增功能 (Added)
- ✨ **提示词优化工具** (`prompt_optimizer`) - 为第三方AI客户端提供结构化的提示词优化指导
  - 支持8种优化类型：通用、创意、技术、商务、教育、绘图、分析、迭代
  - 提供详细的优化分析和改进建议
  - 支持复杂度控制和多语言输出
  - 特别优化了绘图提示词的处理能力
  - 支持迭代优化模式，可以基于现有提示词进行进一步优化

### 技术改进 (Changed)
- 🔧 更新User-Agent版本标识到1.6.0
- 📦 工具总数增加到30+个，提供更全面的提示词管理功能

### 使用说明
新的提示词优化工具可以通过以下方式调用：
```json
{
  "tool": "prompt_optimizer",
  "parameters": {
    "content": "要优化的提示词内容",
    "optimization_type": "general|creative|technical|business|educational|drawing|analysis|iteration",
    "requirements": "特殊要求或限制条件",
    "complexity": "simple|medium|complex",
    "language": "zh|en"
  }
}
```

# 版本更新日志

## v1.5.0 (2024-12-23)

### 🎉 新功能
- 完善了搜索系统，现在所有搜索操作都能正确执行
- 修复了智能语义搜索(smart_semantic_search)的功能问题
- 优化了搜索操作的稳定性和准确性

### 🔧 技术改进
- 解决了UUID类型错误导致的数据库查询失败问题
- 修复了Supabase行级安全策略(RLS)相关的访问问题
- 使用正确的认证方式，确保数据正常读取
- 为搜索操作创建专门的处理逻辑

### 📊 搜索优化
- 现在可以稳定执行各种搜索操作
- 支持按工具类型、关键词等维度搜索
- 完整的错误日志和异常处理

### 🏷️ 数据结构
搜索操作现在会正确处理：
- 执行时间优化
- 结果准确性提升
- 搜索查询内容解析
- 工具类型识别
- 会话状态管理

## v1.4.0 (之前版本)
- 智能语义搜索功能优化
- 统一搜索接口改进
- 多维度搜索算法增强