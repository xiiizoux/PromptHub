# PromptHub MCP Adapter v1.8.1 å‘å¸ƒè¯´æ˜

## ğŸ¯ é‡è¦ä¿®å¤ç‰ˆæœ¬ - å­˜å‚¨åŠŸèƒ½ä¿®å¤

### é—®é¢˜èƒŒæ™¯
v1.8.0åŠä¹‹å‰ç‰ˆæœ¬å­˜åœ¨æ•°æ®åº“å¤–é”®çº¦æŸé…ç½®é”™è¯¯ï¼Œå¯¼è‡´å­˜å‚¨åŠŸèƒ½å¤±è´¥ï¼š
- é”™è¯¯ä¿¡æ¯ï¼š`insert or update on table "prompts" violates foreign key constraint "prompts_user_id_fkey"`
- æœç´¢åŠŸèƒ½æ­£å¸¸ï¼Œä½†æ— æ³•åˆ›å»ºæ–°çš„æç¤ºè¯
- ç”¨æˆ·éªŒè¯é€šè¿‡ä½†æ•°æ®åº“æ’å…¥å¤±è´¥

### ğŸ› ï¸ æ ¸å¿ƒä¿®å¤

#### 1. æ•°æ®åº“å¤–é”®çº¦æŸä¿®å¤
- **é—®é¢˜**ï¼špromptsè¡¨çš„user_idå¤–é”®çº¦æŸé”™è¯¯æŒ‡å‘ä¸å­˜åœ¨çš„auth.usersè¡¨
- **è§£å†³**ï¼šæä¾›æ•°æ®åº“ä¿®å¤è„šæœ¬ä¿®æ­£å¤–é”®çº¦æŸæŒ‡å‘æ­£ç¡®çš„usersè¡¨
- **å½±å“**ï¼šå½»åº•è§£å†³å­˜å‚¨åŠŸèƒ½å¤±è´¥é—®é¢˜

#### 2. ç”¨æˆ·éªŒè¯é€»è¾‘å¢å¼º
- **æ–°å¢**ï¼š`validateUserExists()`æ–¹æ³•è¿›è¡Œæ’å…¥å‰ç”¨æˆ·éªŒè¯
- **ä¼˜åŒ–**ï¼šè¯¦ç»†çš„è°ƒè¯•æ—¥å¿—å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜
- **æ”¹è¿›**ï¼šç§»é™¤è¿‡æ—¶çš„ç³»ç»Ÿç”¨æˆ·å›é€€é€»è¾‘

#### 3. æƒé™ç®¡ç†ç®€åŒ–
- **æ¸…ç†**ï¼šç§»é™¤å¯¹'system-user'çš„ç‰¹æ®Šå¤„ç†
- **ç»Ÿä¸€**ï¼šç®€åŒ–æƒé™éªŒè¯é€»è¾‘
- **ç¨³å®š**ï¼šå‡å°‘å¤æ‚åº¦æé«˜ç³»ç»Ÿç¨³å®šæ€§

### ğŸ”§ æŠ€æœ¯æ”¹è¿›

```javascript
// æ–°å¢ç”¨æˆ·éªŒè¯æ–¹æ³•
private async validateUserExists(userId: string): Promise<void> {
  const user = await this.getUser(userId);
  if (!user) {
    throw new Error(`ç”¨æˆ·éªŒè¯å¤±è´¥: ç”¨æˆ·ID ${userId} åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨`);
  }
}

// åœ¨createPromptä¸­ä½¿ç”¨
await this.validateUserExists(finalUserId);
```

### ğŸ“¦ éƒ¨ç½²æ­¥éª¤

#### 1. æ›´æ–°MCPæœåŠ¡å™¨ä»£ç 
```bash
# æ›´æ–°åˆ°æœ€æ–°ä»£ç 
git pull origin main

# é‡å¯MCPæœåŠ¡å™¨
npm run build
npm start
```

#### 2. æ‰§è¡Œæ•°æ®åº“ä¿®å¤ï¼ˆé‡è¦ï¼‰
```sql
-- æ‰§è¡Œä¿®å¤è„šæœ¬
psql your_database < scripts/fix_foreign_key_constraints.sql
```

#### 3. éªŒè¯ä¿®å¤ç»“æœ
- æœç´¢åŠŸèƒ½ï¼šåº”ä¿æŒæ­£å¸¸
- å­˜å‚¨åŠŸèƒ½ï¼šåº”ç«‹å³æ¢å¤
- æ— éœ€é‡æ–°é…ç½®APIå¯†é’¥

### ğŸ¯ é¢„æœŸæ•ˆæœ

#### ä¿®å¤å‰
```json
{
  "error": {
    "message": "æ™ºèƒ½å­˜å‚¨å¤±è´¥: insert or update on table \"prompts\" violates foreign key constraint \"prompts_user_id_fkey\""
  }
}
```

#### ä¿®å¤å
```json
{
  "schema_version": "v1",
  "data": {
    "success": true,
    "prompt": {
      "id": "uuid-here",
      "name": "æç¤ºè¯æ ‡é¢˜",
      "user_id": "530d5152-bf3e-4bc4-9d78-106a065fa826"
    }
  }
}
```

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»æ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬**ï¼šä»…æ›´æ–°ä»£ç ä¸è¶³ä»¥è§£å†³é—®é¢˜
2. **æ— ç ´åæ€§æ›´æ”¹**ï¼šç°æœ‰æ•°æ®å’Œé…ç½®å®Œå…¨å…¼å®¹
3. **å‘ä¸‹å…¼å®¹**ï¼šAPIæ¥å£ä¿æŒä¸å˜
4. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®åœ¨ç»´æŠ¤çª—å£æœŸé—´éƒ¨ç½²

### ğŸ§ª æµ‹è¯•éªŒè¯

éƒ¨ç½²åå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

```bash
# æµ‹è¯•å­˜å‚¨åŠŸèƒ½
curl -X POST https://mcp.prompt-hub.cc/tools/unified_store/invoke \
  -H "X-Api-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"content": "æµ‹è¯•æç¤ºè¯", "title": "æµ‹è¯•æ ‡é¢˜"}'

# æµ‹è¯•æœç´¢åŠŸèƒ½  
curl -X POST https://mcp.prompt-hub.cc/tools/unified_search/invoke \
  -H "X-Api-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"query": "æµ‹è¯•"}'
```

### ğŸ“ æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ•°æ®åº“ä¿®å¤è„šæœ¬æ˜¯å¦æˆåŠŸæ‰§è¡Œ
2. ç¡®è®¤MCPæœåŠ¡å™¨å·²é‡å¯
3. éªŒè¯APIå¯†é’¥ä»ç„¶æœ‰æ•ˆ
4. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**å‘å¸ƒæ—¶é—´**: 2025-01-19  
**å½±å“èŒƒå›´**: å­˜å‚¨åŠŸèƒ½ä¿®å¤ï¼Œæœç´¢åŠŸèƒ½ä¸å—å½±å“  
**ç´§æ€¥ç¨‹åº¦**: é«˜ï¼ˆä¿®å¤å…³é”®åŠŸèƒ½ï¼‰  
**å…¼å®¹æ€§**: å®Œå…¨å‘ä¸‹å…¼å®¹