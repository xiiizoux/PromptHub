# æ‰‹åŠ¨æ‰§è¡Œè¿ç§»æŒ‡å—

ç”±äºSQLè¯­æ³•é”™è¯¯å·²ä¿®å¤ï¼Œç°åœ¨å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œè¿ç§»ã€‚

## ğŸš€ æ¨èæ‰§è¡Œæ–¹å¼

### æ–¹å¼ä¸€ï¼šSupabase Dashboardï¼ˆæœ€ç®€å•ï¼‰

1. **ç™»å½• Supabase Dashboard**
   - è®¿é—® https://supabase.com/dashboard
   - é€‰æ‹©æ‚¨çš„ PromptHub é¡¹ç›®

2. **æ‰“å¼€ SQL Editor**
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ "SQL Editor"
   - ç‚¹å‡» "New query"

3. **é€æ­¥æ‰§è¡ŒSQLæ–‡ä»¶**

   **æ­¥éª¤1ï¼šæ•°æ®å¤‡ä»½**
   ```sql
   -- å¤åˆ¶ 01_backup_data.sql çš„å†…å®¹å¹¶æ‰§è¡Œ
   -- è¿™ä¼šåˆ›å»ºä¸€ä¸ªå¸¦æ—¶é—´æˆ³çš„å¤‡ä»½è¡¨
   ```

   **æ­¥éª¤2ï¼šæ·»åŠ å­—æ®µ**
   ```sql
   -- å¤åˆ¶ 02_add_content_field.sql çš„å†…å®¹å¹¶æ‰§è¡Œ
   -- è¿™ä¼šæ·»åŠ  content å­—æ®µå’Œç´¢å¼•
   ```

   **æ­¥éª¤3ï¼šæ•°æ®è¿ç§»**
   ```sql
   -- å¤åˆ¶ 03_migrate_data.sql çš„å†…å®¹å¹¶æ‰§è¡Œ
   -- è¿™ä¼šå°† messages è½¬æ¢ä¸º content
   ```

   **æ­¥éª¤4ï¼šéªŒè¯ç»“æœ**
   ```sql
   -- å¤åˆ¶ 04_verify_migration.sql çš„å†…å®¹å¹¶æ‰§è¡Œ
   -- è¿™ä¼šéªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸ
   ```

### æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œï¼ˆå¦‚æœæœ‰psqlï¼‰

```bash
# è®¾ç½®æ•°æ®åº“è¿æ¥
export DATABASE_URL="postgresql://postgres:[password]@[host]:[port]/[database]"

# æ‰§è¡Œè¿ç§»
psql $DATABASE_URL -f migration/01_backup_data.sql
psql $DATABASE_URL -f migration/02_add_content_field.sql
psql $DATABASE_URL -f migration/03_migrate_data.sql
psql $DATABASE_URL -f migration/04_verify_migration.sql
```

## ğŸ“‹ æ‰§è¡Œæ£€æŸ¥æ¸…å•

### æ‰§è¡Œå‰æ£€æŸ¥
- [ ] å·²åœæ­¢åº”ç”¨æœåŠ¡
- [ ] å·²ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å·²å‡†å¤‡å¥½å›æ»šæ–¹æ¡ˆ

### æ‰§è¡Œæ­¥éª¤
- [ ] **æ­¥éª¤1**ï¼šæ‰§è¡Œ `01_backup_data.sql` - åˆ›å»ºå¤‡ä»½
- [ ] **æ­¥éª¤2**ï¼šæ‰§è¡Œ `02_add_content_field.sql` - æ·»åŠ å­—æ®µ
- [ ] **æ­¥éª¤3**ï¼šæ‰§è¡Œ `03_migrate_data.sql` - è¿ç§»æ•°æ®
- [ ] **æ­¥éª¤4**ï¼šæ‰§è¡Œ `04_verify_migration.sql` - éªŒè¯ç»“æœ

### éªŒè¯æ£€æŸ¥
- [ ] å¤‡ä»½è¡¨å·²åˆ›å»ºï¼ˆprompts_backup_YYYYMMDD_HHMMSSï¼‰
- [ ] contentå­—æ®µå·²æ·»åŠ 
- [ ] 90æ¡è®°å½•å·²æˆåŠŸè¿ç§»
- [ ] æœç´¢ç´¢å¼•å·²åˆ›å»º
- [ ] æ— è¿ç§»é”™è¯¯

## ğŸ” é¢„æœŸè¾“å‡º

### æ­¥éª¤1è¾“å‡ºç¤ºä¾‹
```
NOTICE:  å¤‡ä»½è¡¨å·²åˆ›å»º: prompts_backup_20241201_143022
NOTICE:  å¤‡ä»½éªŒè¯ - è¡¨å: prompts_backup_20241201_143022, æ€»è®°å½•: 90, æœ‰messages: 90, æ— messages: 0
```

### æ­¥éª¤3è¾“å‡ºç¤ºä¾‹
```
processed_count | success_count | error_count | sample_results
90             | 90            | 0           | ID: xxx, Name: xxx, Content Length: 245
```

### æ­¥éª¤4è¾“å‡ºç¤ºä¾‹
```
check_type     | total_records | records_with_content | migration_completed
æ€»ä½“ç»Ÿè®¡       | 90           | 90                   | 90
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q: æ‰§è¡Œæ—¶æç¤ºæƒé™é”™è¯¯
**A:** ç¡®ä¿ä½¿ç”¨çš„æ˜¯ service_role å¯†é’¥ï¼Œæˆ–è€…åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ

### Q: è¿ç§»éƒ¨åˆ†å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A:** æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œæ­¥éª¤3ï¼Œæˆ–ä½¿ç”¨å›æ»šè„šæœ¬

### Q: å¦‚ä½•ç¡®è®¤è¿ç§»æˆåŠŸï¼Ÿ
**A:** æ£€æŸ¥æ­¥éª¤4çš„è¾“å‡ºï¼Œç¡®ä¿ `migration_completed` ç­‰äºæ€»è®°å½•æ•°

## ğŸ”„ å¦‚æœéœ€è¦å›æ»š

```sql
-- æ‰§è¡Œå›æ»šï¼ˆç´§æ€¥æƒ…å†µï¼‰
SELECT rollback_migration();
SELECT * FROM verify_rollback();
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. æ‰§è¡Œåˆ°å“ªä¸€æ­¥
3. æ•°æ®åº“ç¯å¢ƒä¿¡æ¯

ç°åœ¨å¯ä»¥å®‰å…¨åœ°å¼€å§‹è¿ç§»äº†ï¼å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ã€‚
