# Supabase数据库测试脚本

本目录包含Supabase数据库相关的测试脚本，用于验证数据库结构、数据完整性和功能正确性。

## 测试脚本

### validate_schema.sh
- **用途**: 验证数据库schema结构
- **功能**: 
  - 检查SQL语法正确性
  - 验证必需表的存在性
  - 检查权限管理字段完整性
  - 验证RLS策略完整性
  - 检查索引存在性
  - 验证触发器和函数完整性
- **使用**: `./validate_schema.sh`
- **输出**: 详细的验证报告和统计信息

## 验证项目

### 基本语法检查
- 括号匹配验证
- 引号匹配验证
- SQL语法基本检查

### 数据库结构验证
- **表结构**: 验证11个核心表的存在
- **索引**: 检查18个性能优化索引
- **RLS策略**: 验证25个行级安全策略
- **函数**: 检查3个自定义函数
- **触发器**: 验证3个自动化触发器

### 权限管理验证
- 用户权限字段完整性
- 协作权限设置
- 审计日志功能
- 数据安全策略

## 使用说明

1. **运行前准备**:
   - 确保在项目根目录执行
   - 确保有schema.sql文件
   - 确保有bash环境

2. **执行验证**:
   ```bash
   cd supabase/tests
   ./validate_schema.sh
   ```

3. **结果解读**:
   - ✅ 表示验证通过
   - ❌ 表示验证失败
   - 最后显示总体统计信息

## 扩展测试

可以根据需要添加更多测试脚本：
- 数据迁移测试
- 性能基准测试
- 数据完整性测试
- 备份恢复测试

## 注意事项

- 测试脚本不会修改数据库，仅进行验证
- 建议在数据库结构变更后运行验证
- 验证失败时请检查schema.sql文件
- 可以根据项目需求调整验证规则 